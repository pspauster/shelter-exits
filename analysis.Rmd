---
title: "analysis"
author: "Patrick"
date: "2024-01-24"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(janitor)

knitr::opts_chunk$set(echo = TRUE, include = F, warning = F)
```

```{r}
exits <- read_csv("data/shelter_exits.csv")
```

```{r}
exits %>% 
  group_by(category, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  adorn_totals(where = c("row", "col")) %>% 
  DT::datatable()
```

```{r}
exits %>% 
  group_by(category, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  ungroup() %>% 
  mutate_at(vars(adult_families:total_single_adults), ~.x/sum(.x, na.rm=T)*100) %>% 
  DT::datatable()
```

```{r}
exits %>% 
  group_by(agency, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T),) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  DT::datatable()
```

```{r}
exits %>% 
  group_by(date, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  adorn_totals(where = c("row", "col")) %>% 
  DT::datatable()


```

```{r}
sum_month_category <- exits %>% 
  group_by(date, category, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  adorn_totals(where = c("row", "col")) %>% 
  DT::datatable()
```

sum_month_category <- shelter_exits_clean %>% 
  group_by(date, category) %>% 
  summarize(total_families_exited = sum(families_with_children, na.rm = T)+sum(adult_families, na.rm = T),
            families_with_children_exited = sum(families_with_children, na.rm = T),
            adult_families_exited= sum(adult_families, na.rm = T),
            single_adults_exited = sum(total_single_adults, na.rm = T)
  )


percentage_sum_month <- shelter_exits_clean %>% 
  group_by(date, category) %>% 
  summarize(total_families_exited = sum(families_with_children, na.rm = T)+sum(adult_families, na.rm = T),
            families_with_children_exited = sum(families_with_children, na.rm = T),
            adult_families_exited= sum(adult_families, na.rm = T),
            single_adults_exited = sum(total_single_adults, na.rm = T)
  ) %>% 
  ungroup() %>% 
  group_by(date) %>% 
  mutate_at(vars(total_families_exited:single_adults_exited), ~.x/sum(.x, na.rm=T)*100)

ggplot(percentage_sum_month) +
  geom_line(mapping = aes(x=date, y=total_families_exited, color = category))

sum_month_category %>% 
  ggplot(aes(x = date, y = total_families_exited, color = category)) +
  geom_line()

ggplot(percentage_sum_month) +
  geom_line(mapping = aes(x=date, y=single_adults_exited, color = category))

sum_month_category %>% 
  ggplot(aes(x = date, y = single_adults_exited, color = category)) +
  geom_line()

shelter_exits_clean %>% 
  group_by(date) %>% 
  summarize(
            families_with_children_exited = sum(families_with_children, na.rm = T),
            adult_families_exited= sum(adult_families, na.rm = T),
            single_adults_exited = sum(total_single_adults, na.rm = T)) %>% 
  pivot_longer(cols = families_with_children_exited:single_adults_exited, names_to = "series", values_to = "exits") %>% 
  ggplot()+
  geom_line(aes(x=date, y=exits, color = series))
