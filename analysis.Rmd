---
title: "analysis"
author: "Patrick"
date: "2024-01-24"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(janitor)
library(DT)

knitr::opts_chunk$set(echo = FALSE, warning = F, message = F)
```
# Total Exits
```{r}
exits <- read_csv("data/shelter_exits.csv") %>% 
  filter(!is.na(category))
```
## Total exits by category

The large majority exiting are families with children or total_single adults
```{r}
exits %>% 
  group_by(category, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  adorn_totals(where = c("row", "col")) %>% 
  DT::datatable(options = list(iDisplayLength = 25))
```
### Total exits by category, proportion of population
```{r}
exits %>% 
  group_by(category, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  ungroup() %>% 
  mutate_at(vars(adult_families:total_single_adults), ~.x/sum(.x, na.rm=T)) %>% 
  datatable(options = list(iDisplayLength = 25)) %>% 
  formatPercentage(2:5)
```

## Total exits by agency

The huge majority of exits are from DHS
```{r}
exits %>% 
  group_by(agency, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T),) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  DT::datatable()
```
# Monthly exits

```{r}
exits %>% 
  group_by(date, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  pivot_wider(names_from = "series", values_from = "total_exits") %>%
  adorn_totals(where = c("row", "col")) %>% 
  DT::datatable()

exits %>% 
  filter(agency == "DHS") %>% 
  group_by(date, series) %>% 
  summarize(total_exits = sum(exits, na.rm = T)) %>% 
  ggplot()+
  geom_line(aes(x=date, y = total_exits, color = series))+
  labs(title = "DHS Total Exits by Month",
       subtitle = "all series")

```

## Families with children
Unknown exits are rising in large numbers and now make up most of the exits from shelter

```{r}
dhs_month_category <- exits %>% 
  filter(agency == "DHS") %>% 
  group_by(date, category, series) %>% 
  summarize(exits = sum(exits, na.rm = T)) %>% 
  ungroup() %>% 
  group_by(date, series) %>% 
  mutate(per_exits = exits/sum(exits, na.rm = T)*100)
  #pivot_wider(names_from = "series", values_from = "total_exits") %>%

dhs_month_category %>% 
  filter(series == "families_with_children") %>% 
  ggplot()+
  geom_line(aes(x=date, y = exits, color = category))+
  labs(title = "DHS Total Exits by Type",
       subtitle = "families with children")

dhs_month_category %>% 
  filter(series == "families_with_children") %>% 
  ggplot()+
  geom_line(aes(x=date, y = per_exits, color = category))+
  labs(title = "DHS Percentage of Exits by Type",
       subtitle = "families_with_children")
```
## Single Adults

A huge proportion of single adults exiting go to unknown places

```{r}
dhs_month_category %>% 
  filter(series == "total_single_adults") %>% 
  ggplot()+
  geom_area(aes(x=date, y = exits, fill = category))+
  labs(title = "DHS Total Exits by Type",
       subtitle = "total_single_adults")

dhs_month_category %>% 
  filter(series == "total_single_adults") %>% 
  ggplot()+
  geom_area(aes(x=date, y = per_exits, fill = category))+
  labs(title = "DHS Percentage of Exits by Type",
       subtitle = "total_single_adults")


```



